---

-   yum:
        name: "{{ item }}"
        state: present
    with_items:
        - openssh

-   name: "Lookup ssh dir"
    become_user: "{{ username }}"
    set_fact:
        ssh_dir: "{{ lookup('env','HOME') }}/.ssh"

-   name: Import nodes keys
    become_user: "{{ username }}"
    shell: "ssh-keyscan {{ item }}"
    with_items: "{{ ssh_hosts }}"
    changed_when: false
    register: known_host_results
    ignore_errors: yes

-   name: "Update the {{ ssh_dir }}/known_hosts file with nodes"
    become_user: "{{ username }}"
    known_hosts:
        name: "{{ item.item }}"
        key: "{{ item.stdout }}"
        path: "{{ ssh_dir }}/known_hosts"
    with_items: "{{ known_host_results.results }}"
